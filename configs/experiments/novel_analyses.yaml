# =============================================================================
# Novel Perception-vs-Imagery Analysis Configuration
# =============================================================================
#
# Six research directions for neuroscience discovery.
# See: scripts/run_novel_analyses.py, docs/research/PAPER_DRAFT_OUTLINE.md

experiment:
  name: "novel_perception_vs_imagery"
  description: >
    Comprehensive analysis of perception-to-imagery transfer including
    dimensionality gap, uncertainty-vividness, semantic survival,
    topological RSA, and cross-subject imagery fingerprints.

# Which analyses to run (all fifteen directions)
analyses:
  - dimensionality         # Direction 1: The Dimensionality Gap
  - uncertainty            # Direction 2: Uncertainty as Vividness
  - semantic               # Direction 3: Semantic Survival
  - topology               # Direction 4: Topological RSA
  - cross_subject          # Direction 5: Cross-Subject Imagery Fingerprint
  - dissociation           # Direction 6: Semantic-Structural Dissociation
  - reality_monitor        # Direction 7: Computational Reality Monitor
  - confusion_mapping      # Direction 8: Reality Confusion Mapping
  - adversarial_reality    # Direction 9: Adversarial Reality Probing
  - hierarchical_reality   # Direction 10: Hierarchical Reality Gradient
  - compositional          # Direction 11: Compositional Imagination (Brain Algebra)
  - predictive_coding      # Direction 12: Predictive Coding Residual Analysis
  - manifold_geometry      # Direction 13: Imagination Manifold Geometry
  - modality_decomposition # Direction 14: Modality-Invariant Decomposition
  - creative_divergence    # Direction 15: Creative Divergence Mapping

# Model checkpoint (perception-trained encoder)
model:
  checkpoint: "checkpoints/two_stage/subj01/best.pt"
  type: "two_stage"
  device: "cuda"

# Data
data:
  subjects:
    - "subj01"
    - "subj02"
    - "subj05"
    - "subj07"
  perception_index_pattern: "cache/indices/nsd_index/{subject}.parquet"
  imagery_index_pattern: "cache/indices/imagery/{subject}.parquet"
  cache_root: "cache"
  max_samples: null  # null = all samples

# Direction-specific settings
dimensionality:
  variance_threshold: 0.95
  k_nn: 10
  max_pca_components: 200

uncertainty:
  n_mc_samples: 30
  batch_size: 64

semantic:
  # Uses built-in concept lists (15 semantic + 15 visual)
  device: "cpu"  # CLIP model device

topology:
  k_values: [5, 10, 20, 50]
  max_ph_samples: 200  # subsample for persistent homology

cross_subject:
  adapter_checkpoint_pattern: "checkpoints/adapters/{subject}/best.pt"

dissociation:
  targets: ["clip", "ip_adapter", "sd_vae"]
  ssi_formula: "clip_preservation / sd_vae_preservation"

# Direction 7: Computational Reality Monitor (Dijkstra's PRM)
reality_monitor:
  n_folds: 5
  n_pca_content: 50
  feature_modes: ["signal_strength", "content", "combined"]

# Direction 8: Reality Confusion Mapping
confusion_mapping:
  n_bins: 20  # bins for sigmoid boundary estimation

# Direction 9: Adversarial Reality Probing
adversarial_reality:
  n_epochs: 100
  batch_size: 64
  hidden_dim: 256
  lr_discriminator: 1e-3
  lr_generator: 5e-4

# Direction 10: Hierarchical Reality Gradient
hierarchical_reality:
  layers: ["layer_4", "layer_8", "layer_12", "final"]
  n_folds: 5

# Direction 11: Compositional Imagination (Brain Algebra)
compositional:
  n_trials: 200
  top_fraction: 0.25
  perturbation_scale: 0.5

# Direction 12: Predictive Coding Residual Analysis
predictive_coding:
  alpha: 1.0  # Ridge regression regularization
  layers: ["layer_4", "layer_8", "layer_12", "final"]

# Direction 13: Imagination Manifold Geometry
manifold_geometry:
  n_hull_projections: 20
  n_pca_components: 50

# Direction 14: Modality-Invariant Decomposition
modality_decomposition:
  retrieval_k_values: [1, 5, 10]
  classifier_cv_folds: 5

# Direction 15: Creative Divergence Mapping
creative_divergence:
  n_archetype_clusters: [2, 6]  # min and max k for archetype search
  n_pca_components: 20

# Output
output:
  dir: "outputs/novel_analyses"
  save_figures: true
  figure_format: ["png", "pdf"]
